# Cloud Storage
## ストレージクラスと最小保存期間
| 種類 | 最小保存期間 |
| ---- | ----|
| Standard | - |
| Nearline | 30日 |
| Coldline | 90日 |
| Archive | 365日 |


# App Engine
## トラフィック分割
- 複数バージョン間でトラフィックの分割が可能
- 分割方法
    - Cookie 分割
    - IP アドレス分割
    - ランダム分割: 均等な分散
- `gcloud app services set-traffic`: --splits コマンドで, 各バージョンに送信するトラフィックの割合を設定できる
    - 例: `gcloud app services set-traffic s1 --splits=v2=1`

## フレキシブル環境
- App Engine 環境でコンテナを実行可能


# Google Kubernetes Engine
- ノードに IP アドレスを付与して直接通信することが可能

## Standard モード
### ゾーンクラスタ
- **1つのゾーン内に1つのコントロールプレーン**が含まれる
- ノードを単一または複数のゾーンに分散できる

#### シングルゾーンクラスタ
- 1つのゾーンで動作する1つのコントロールプレーン
- 同じゾーンで動作するノードを管理
#### マルチゾーンクラスタ
- 1つのゾーンで動作する1つのコントロールプレーン + **1つのレプリカ**
- **複数のゾーンで動作する複数のノード**

### リージョンクラスタ
- コントロールプレーンとノードを単一リージョン内の複数のゾーンに複製する

## Autopilot
- 自動的にリージョンクラスタが選択される


# クラウドソリューションの正常な運用
- Ops エージェントを使用すると load_5m メトリクスでインスタンスから5分間隔で CPU 負荷に関するデータを取得することができる
- オペレーションスイートのワークスペースは**プロジェクトにリンクされている**
    - 複数のプロジェクトを1つのワークスペースに関連付けることも可能
- セカンダリ範囲(エイリアス範囲): サブネット内で IP アドレス範囲を拡張できる
- プロジェクトのリソースごとに予算超過のアラートを設定可能
- Cloud Monitoring は**指標スコープ**にメトリクスを収集してモニタリングを実施する
    - 複数のプロジェクトにある Compute Engine をモニタリングするには新規にプロジェクトを作成するか, リソースのないプロジェクトを使用することが推奨される
- Cloud SQL では自動バックアップをスケジュールできるが, 期間は1年間までに限られる. また日次で行われる.
- 仮想マシンの複製に用いられるのは**マシンイメージ**
    - スナップショットはバックアップに用いられる
- プロジェクトの上限を増やすにはコンソールの"クォータの管理"からリクエストを送信する
- Compute Engine では**スナップショットスケジュール**が利用可能; スナップショットの作成時間や保持期間を設定可能


# クラウドソリューションの計画と構成
- Cloud Run がコンテナを開始すると以下の環境変数が構成される
    - K_Configuration: 構成の名前 
    - K_Revision: リビジョンの名前
    - K_Serice: 実行されているサービスの名前
    - Port: リッスンするポート
- VPN は"ハイブリッド接続"から構成する
    - Cloud VPN: データ接続の少ない場合
    - Cloud Interconnect
    - Google ピアリング
- **階層型ファイアーウォールポリシー**: 組織全体で一貫したファイアウォール ポリシーを適用できる
    - ファイアーウォールルールのコンテナ
    - 全てのルールが対象の組織またはフォルダに適用される
    - VPC ファイアウォールでは実現不可; 特定のプロジェクトまたはネットワークに関連付けられる
- Bigtable の操作には cbt コマンドを使用する
- 限定公開: 内部 IP アドレスしか持たない VM インスタンスが外部にアクセスするための機能
    - privatelink のような機能?

# クラウドソリューション環境の設定
- Datastore のバックアップには datastore.databases.export と datastore.databases.import 権限が必要
- Looker Studio で費用を可視化するには Bigquery ビューを作成する


# アクセスとセキュリティの構成
- `gsutil iam ch`: Cloud Storage に対する権限変更
    - `gsutil iam ch allUsers:objectViewer gs://ex-bucket`
- Compute Engine の**スコープ**は, VM の内部からアクセス可能な Google Cloud API を制限する
    - サービスアカウントに付与された IAM で許可されていても, スコープで拒否されている場合は許可されない